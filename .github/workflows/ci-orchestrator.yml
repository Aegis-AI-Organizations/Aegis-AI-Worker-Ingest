name: Aegis CI/CD Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:

permissions:
  contents: write
  packages: write
  pages: write
  id-token: write

jobs:
  # 1. Linting
  call-lint:
    uses: ./.github/workflows/linting.yml

  # 2. Build & Test
  call-tests:
    needs: call-lint
    uses: ./.github/workflows/build-and-test.yml

  # 3. Auto-Release (On push to main)
  call-release:
    needs: call-tests
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    uses: ./.github/workflows/release.yml
